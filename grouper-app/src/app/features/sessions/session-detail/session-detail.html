@if (session) {
  <div class="session-detail-container">
    <div class="header">
      <button mat-icon-button (click)="back()" [attr.aria-label]="'common.back' | t">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1>{{ session.name }}</h1>
    </div>

    <div class="content-layout">
      <div class="layout-row top-row">
        <app-session-people-card
          [people]="sortedPeople"
          (addPerson)="addPerson()"
          (openPerson)="openPersonWeights($event)"
          (removePerson)="removePerson($event)" />

        @if (selectedPerson; as currentPerson) {
          @for (person of [currentPerson]; track person.id) {
            <app-person-drawer
              [selectedPerson]="person"
              [people]="sortedPeople"
              [customWeights]="session.customWeights"
              [preferences]="session.preferences"
              (closeDrawer)="closePersonWeights()"
              (updateName)="updatePersonName(person.id, $event)"
              (updateGender)="updatePersonGender(person.id, $event)"
              (updatePreference)="onPreferenceChange(person.id, $event.targetPersonId, $event.value)"
              (updateWeight)="updatePersonWeight(person.id, $event.weightId, $event.value)" />
          }
        }
      </div>

      <div class="layout-row middle-row">
        <app-grouping-config-card
          [groupingStrategyControl]="groupingStrategyControl"
          [groupSizeControl]="groupSizeControl"
          [allowPartialGroupsControl]="allowPartialGroupsControl"
          [genderModeControl]="genderModeControl"
          [preferenceWantWithControl]="preferenceWantWithControl"
          [preferenceAvoidControl]="preferenceAvoidControl"
          [customWeights]="session.customWeights"
          [selectedWeightIds]="selectedWeightIds"
          [genderWeightId]="genderWeightId"
          [peopleCount]="session.people.length"
          (generateGroups)="generateGroups()"
          (resetSession)="resetSession()"
          (toggleWeightSelection)="toggleWeightSelection($event)" />

        <app-custom-weights-card
          [customWeights]="session.customWeights"
          [newWeightNameControl]="newWeightNameControl"
          (addWeight)="addCustomWeight()"
          (renameWeight)="renameCustomWeight($event.weight, $event.name)"
          (removeWeight)="removeCustomWeight($event)" />
      </div>

      @if (currentResult) {
        <div class="layout-row bottom-row">
          <app-groups-result-card
            [result]="currentResult"
            [people]="session.people"
            (regenerate)="regenerateGroups()" />
        </div>
      }
    </div>
  </div>
}
