<div class="session-detail-container" *ngIf="session">
  <div class="header">
    <button mat-icon-button (click)="back()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>{{ session.name }}</h1>
  </div>

  <div class="content-grid">
    <!-- People Management -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>People ({{ session.people.length }})</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="people-list">
          <div *ngFor="let person of session.people" class="person-item">
            <mat-icon>person</mat-icon>
            <span>{{ person.name }}</span>
            <button mat-icon-button color="warn" (click)="removePerson(person)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <div class="empty-state" *ngIf="session.people.length === 0">
            <p>No people yet</p>
          </div>
        </div>
        <button mat-raised-button color="primary" (click)="addPerson()" class="add-button">
          <mat-icon>add</mat-icon>
          Add Person
        </button>
      </mat-card-content>
    </mat-card>

    <!-- Preferences Matrix -->
    <mat-card class="section-card preferences-card">
      <mat-card-header>
        <mat-card-title>Preferences</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="session.people.length >= 2" class="preferences-matrix">
          <div class="matrix-scroll">
            <table>
              <thead>
                <tr>
                  <th></th>
                  <th *ngFor="let targetPerson of session.people">{{ targetPerson.name }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let person of session.people">
                  <td class="row-header">{{ person.name }}</td>
                  <td *ngFor="let targetPerson of session.people">
                    <select
                      *ngIf="person.id !== targetPerson.id"
                      [value]="getPreference(person.id, targetPerson.id)"
                      (change)="onPreferenceChange(person.id, targetPerson.id, $any($event.target).value)"
                      class="preference-select">
                      <option value="none">-</option>
                      <option value="wantWith">Want with</option>
                      <option value="avoid">Avoid</option>
                    </select>
                    <span *ngIf="person.id === targetPerson.id" class="diagonal">-</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="empty-state" *ngIf="session.people.length < 2">
          <p>Add at least 2 people to set preferences</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Grouping Configuration -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Create Groups</mat-card-title>
      </mat-card-header>
      <mat-card-content class="grouping-config">
        <mat-form-field>
          <mat-label>Strategy</mat-label>
          <select matNativeControl [(ngModel)]="groupingStrategy">
            <option [value]="GroupingStrategy.RANDOM">Random</option>
            <option [value]="GroupingStrategy.PREFERENCE_BASED">Preference-Based</option>
          </select>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Group Size</mat-label>
          <input matNativeControl type="number" [(ngModel)]="groupSize" min="1" [max]="session.people.length">
        </mat-form-field>

        <mat-checkbox [(ngModel)]="allowPartialGroups">
          Allow partial groups
        </mat-checkbox>

        <button mat-raised-button color="primary" (click)="generateGroups()" [disabled]="session.people.length === 0">
          <mat-icon>shuffle</mat-icon>
          Generate Groups
        </button>
      </mat-card-content>
    </mat-card>

    <!-- Generated Groups Display -->
    <mat-card class="section-card groups-display" *ngIf="currentResult">
      <mat-card-header>
        <mat-card-title>
          Generated Groups
          <span class="satisfaction-badge" *ngIf="currentResult.overallSatisfaction !== undefined">
            Satisfaction: {{ currentResult.overallSatisfaction }}
          </span>
        </mat-card-title>
        <button mat-icon-button (click)="regenerateGroups()">
          <mat-icon>refresh</mat-icon>
        </button>
      </mat-card-header>
      <mat-card-content>
        <div class="groups-grid">
          <div *ngFor="let group of currentResult.groups" class="group-card">
            <div class="group-header">
              <h3>{{ group.name }}</h3>
              <span class="score" *ngIf="group.satisfactionScore !== undefined">
                Score: {{ group.satisfactionScore }}
              </span>
            </div>
            <div class="group-members">
              <div *ngFor="let memberId of group.memberIds" class="member">
                <mat-icon>person</mat-icon>
                <span>{{ getPersonName(memberId) }}</span>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
